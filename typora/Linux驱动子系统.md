

# 1.input子系统

参考文章：  
		[input子系统1](https://blog.csdn.net/qq_17639223/article/details/119489552)、[Input子系统2](https://www.ngui.cc/article/show-547517.html)、[Input子系统3](https://blog.csdn.net/haofeng_ma/article/details/122427495)

## 1.1. input子系统简介

​		按键、鼠标、键盘、触摸屏等都属于输入(input) 设备，Linux内核为此专门做了一个叫做input子系统的框架来处理输入事件。  
​		输入设备本质还是字符设备，只是在此基础上套上了input框架(针对输入设备而创建的框架)，用户只需要负责上报输入事件，input核心层负责处理这些，如：   
​				①按键/键盘：按键信息。②鼠标/触摸屏：坐标信息。

​		引入输入子系统的好处：  
​				①统一了物理形态各异的相似的输入设备的处理功能。例如，各种鼠标，不论PS/2、USB、还是蓝牙，都被同样处理。  
​				②驱动不必创建、管理/dev节点以及相关的访问方法。例如，在终端系统中，我们不需要去管有多少个键盘，多少个鼠标。应用程序只要从输入子系统中去取对应的事件(按键，鼠标移位等)就可以了。而底层设备也不需要直接对接应用程序，只要处理并处理对应的事件即可。  
​				③抽取出了输入驱动的通用部分，简化了驱动，并提供了一致性。例如，输入子系统提供了一个底层驱动（成为serio）的集合，支持对串口和键盘控制器等硬件输入的访问。

## 1.2.input子系统分层:

### 1.2.1. 文字描述

（1） 硬件层：具体的硬件设备，如：按键、USB 键盘/鼠标等。  
（2）内核层：  
			①**驱动层**：输入设备的具体驱动程序，主要实现对硬件设备的读写访问，中断设置，并把硬件产生的事件转换为核心层定义的规范提交给事件处理层，即：将底层的硬件输入转化为统一事件形式向核心测过（Input Core）汇报，如：按键驱动程序，向内核层报告输入内容。  
			②**核心层**（Input core）：对于核心层而言，为设备驱动层提供了规范和接口。设备驱动层只要关心如何驱动硬件并获得硬件数据（例如按下的按键数据），然后调用核心层提供的接口，核心层会自动把数据提交给事件处理层。  
			承上启下：<1>为驱动层提供输入设备注册和操作接口。<2>通知事件层对输入事件进行处理。  
			③**事件层**（Event Handler）：主要和用户空间进行交互。  
（3）用户层：所有的输入设备都以文件形式提供给用户应用程序使用。（Linux中在用户空间将所有的设备都当作文件来处理，由于在一般的驱动程序中都有提供fops接口，以及在/dev下会生成相应的设备文件nod，这些操作在输入子系统中由事件处理层完成）。

### 1.2.2. 框架示意图

![image-20230203131739678](C:\Users\acer\AppData\Roaming\Typora\typora-user-images\image-20230203131739678.png)

### 1.2.3. 层级通信

​		各层之间通信的基本单位是事件， 任何一个输入设备的动作都可以抽象成一种事件， 如键盘的按下，触摸屏的按下， 鼠标的移动等。  
​		事件有三种属性: 类型(type), 编码(code),值(value)， input 子系统支持的所有事件都定义在 input.h 中， 包括所有支持的类型， 所属类型支持的编码等。  
​		事件传送的方向：硬件驱动层-->子系统核心-->事件处理层-->用户空间。  
​		在节点/dev/input 下面则是输入设备的节点。

## 1.3.文档介绍

路径：linux-5.4.194/Documentation/input

### 1.3.1.input.rst

​		输入子系统是一组驱动程序，旨在支持Linux下的所有输入设备。大多数驱动程序都驻留在驱动程序/输入中，尽管有相当多的驱动程序/隐藏和驱动程序/平台中。

​		输入子系统的核心是输入模块，它必须在任何其他输入模块之前加载-它是两组模块之间的通信方式：
